{% extends "admin/index.html" %}
{% load i18n %}

{% block content %}
{% if user.is_superuser or user.is_staff %}

<!-- ===== Dashboard Top Bar (横一列) ===== -->
<div class="admin-topbar">
    {% if is_developer_or_superuser %}
    <a href="{% url 'admin_debug_panel' %}" class="admin-topbar__item admin-topbar__item--debug">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/>
        </svg>
        {% trans "デバッグパネル" %}
    </a>
    {% endif %}
    <a href="{% url 'admin_sales_dashboard' %}" class="admin-topbar__item admin-topbar__item--sales">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
        {% trans "売り上げダッシュボード" %}
    </a>
    <a href="{% url 'admin_iot_mq9' %}" class="admin-topbar__item admin-topbar__item--sensor">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
        {% trans "センサーモニタ" %}
    </a>
</div>

{% endif %}

{{ block.super }}

<!-- ===== 最近行った操作を右カラムに移動 + 折りたたみ ===== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    var recentModule = document.getElementById('recent-actions-module');
    if (!recentModule) return;

    // Wrap in collapsible container
    var wrapper = document.createElement('div');
    wrapper.className = 'admin-recent-wrapper';

    var toggle = document.createElement('button');
    toggle.type = 'button';
    toggle.className = 'admin-recent-toggle';
    toggle.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg> <span>{% trans "最近行った操作" %}</span>';

    var isCollapsed = localStorage.getItem('admin_recent_collapsed') === 'true';

    toggle.addEventListener('click', function() {
        isCollapsed = !isCollapsed;
        recentModule.style.display = isCollapsed ? 'none' : '';
        toggle.querySelector('svg').style.transform = isCollapsed ? 'rotate(-90deg)' : '';
        localStorage.setItem('admin_recent_collapsed', isCollapsed);
    });

    recentModule.parentNode.insertBefore(wrapper, recentModule);
    wrapper.appendChild(toggle);
    wrapper.appendChild(recentModule);

    if (isCollapsed) {
        recentModule.style.display = 'none';
        toggle.querySelector('svg').style.transform = 'rotate(-90deg)';
    }
});
</script>
{% endblock %}
